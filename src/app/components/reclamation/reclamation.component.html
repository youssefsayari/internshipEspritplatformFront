<div class="panel-header panel-header-sm"></div>
<div class="reclamation-container">
  <h2>ğŸ“¢ Do you wanna write a complaint?</h2>

  <!-- Formulaire utilisateur -->
  <form *ngIf="isUser()" (ngSubmit)="createOrUpdateReclamation()" class="reclamation-form">
    <input [(ngModel)]="newReclamation.subject" name="subject" placeholder="Sujet" required />
    <textarea [(ngModel)]="newReclamation.description" name="description" placeholder="Description" required></textarea>
    <button class="add-btn" type="submit">+ Ajouter</button>
  </form>

  <!-- âœ… Filtres visibles uniquement pour lâ€™admin -->
  <div *ngIf="isAdminUser()" class="filter-buttons" style="text-align:center; margin: 1rem 0;">
    <button (click)="onFilterChange('NEW')" [class.active]="selectedFilter === 'NEW'" class="edit-btn">
      ğŸ†• New Complaints
    </button>
    <button (click)="onFilterChange('IN_PROGRESS')" [class.active]="selectedFilter === 'IN_PROGRESS'" class="edit-btn">
      ğŸ”§ My Complaints
    </button>
    <button (click)="toggleArchive()" class="edit-btn">
      ğŸ“¦ Archive
    </button>
  </div>

  <!-- âœ… Liste filtrÃ©e ADMIN -->
  <ul class="reclamation-list" *ngIf="isAdminUser() && selectedFilter && !showArchive">
    <li *ngFor="let r of filteredReclamations" class="reclamation-item">
      <div class="reclamation-header">
        <strong>â€¢ {{ r.subject }}</strong>
        <span class="status" [ngClass]="r.status">{{ r.status }}</span>
      </div>

      <!-- âœ… Affiche ID utilisateur -->
      <div><strong>ğŸ‘¤ ID utilisateur :</strong> {{ r.userId }}</div>

      <div>{{ r.description }}</div>

      <!-- ADMIN - Actions sur PENDING -->
      <div *ngIf="r.status === 'PENDING'" class="admin-actions">
        <button class="edit-btn" (click)="progressReclamation(r)">âœ… IN progress</button>
        <button class="reject-btn" (click)="rejectByAdmin(r)">âŒ Rejected</button>
      </div>

      <!-- ADMIN - RÃ©ponse en cours -->
      <div *ngIf="r.status === 'IN_PROGRESS'">
        <textarea [(ngModel)]="responseText[r.id!]" placeholder="RÃ©ponse admin"></textarea>
        <button class="edit-btn" (click)="respondToReclamation(r)">âœ… Resolved</button>
      </div>
    </li>
  </ul>

  <!-- âœ… Liste Ã©tudiante -->
  <ul class="reclamation-list" *ngIf="isUser() && !showArchive">
    <li *ngFor="let r of studentRelevantReclamations" class="reclamation-item">
      <div class="reclamation-header">
        <strong>â€¢ {{ r.subject }}</strong>
        <span class="status" [ngClass]="r.status">{{ r.status }}</span>
      </div>

      <div>{{ r.description }}</div>

      <!-- RÃ©solu -->
      <div *ngIf="r.status === 'RESOLVED'">
        <strong>ğŸ“ RÃ©ponse admin :</strong>
        <div>{{ r.response }}</div>
      </div>

      <!-- RejetÃ©e -->
      <div *ngIf="r.status === 'REJECTED'">
        <div class="rejected-indicator">â— Votre rÃ©clamation a Ã©tÃ© rejetÃ©e.</div>
      </div>

      <!-- Supprimer -->
      <button class="reject-btn" (click)="deleteReclamation(r.id!)">ğŸ—‘ Supprimer</button>

      <!-- Modifier uniquement si PENDING -->
      <button *ngIf="r.status === 'PENDING'" class="edit-btn" (click)="editReclamation(r)">
        âœï¸ Modifier
      </button>
    </li>
  </ul>

  <!-- âœ… ARCHIVE ADMIN / USER -->
  <div *ngIf="showArchive && archivedReclamations && archivedReclamations.length > 0" class="archive-section">
    <h3>ğŸ“¦ Historique des RÃ©clamations RÃ©solues</h3>
    <ul class="reclamation-list">
      <li *ngFor="let r of archivedReclamations" class="reclamation-item">
        <div class="reclamation-header">
          <strong>{{ r.subject }}</strong>
          <span class="status RESOLVED">RESOLVED</span>
        </div>

        <!-- âœ… Affiche ID utilisateur -->
        <div *ngIf="isAdminUser()"><strong>ğŸ‘¤ ID utilisateur :</strong> {{ r.userId }}</div>

        <div><strong>Description :</strong> {{ r.description }}</div>
        <div><strong>RÃ©ponse :</strong> {{ r.response || 'Pas de rÃ©ponse enregistrÃ©e.' }}</div>
        <div><strong>EnvoyÃ©e le :</strong> {{ r.createdAt ? formatDate(r.createdAt) : 'Non dÃ©fini' }}</div>
        <div><strong>RÃ©pondue le :</strong> {{ r.updatedAt ? formatDate(r.updatedAt) : 'Non dÃ©fini' }}</div>
      </li>
    </ul>
  </div>

  <!-- Aucun rÃ©sultat -->
  <div *ngIf="isAdminUser() && selectedFilter && filteredReclamations && filteredReclamations.length === 0 && !showArchive" class="empty-state">
    Aucune rÃ©clamation dans cette catÃ©gorie.
  </div>
</div>
